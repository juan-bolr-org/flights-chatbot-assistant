graph TB
    subgraph FastAPIApp["FastAPI Application"]
        Main[main.py]
        Routers[Route Handlers]
        VoiceRouter[Voice Chat Router]
    end
    
    subgraph BusinessLayer["Business Layer"]
        UserService[User Service]
        FlightService[Flight Service]
        BookingService[Booking Service]
        ChatService[Chat Service]
        HealthService[Health Service]
    end
    
    subgraph RepositoryLayer["Repository Layer (Abstraction)"]
        UserRepo[User Repository]
        FlightRepo[Flight Repository]
        BookingRepo[Booking Repository]
        ChatRepo[Chat Repository]
    end
    
    subgraph DataLayer["Data Layer"]
        UserModel[User Model]
        FlightModel[Flight Model]
        BookingModel[Booking Model]
        ChatModel[Chat Model]
        SQLite[(SQLite Database)]
    end
    
    subgraph CrossCutting["Cross-Cutting Concerns"]
        Auth[JWT Authentication]
        Logging[Logging System]
        Dependencies[DI Container]
        Resources[App Resources]
        AudioProcessor[Audio Processing]
    end
    
    subgraph AIIntegration["AI Integration"]
        ChatManager[Chat Manager]
        LangGraph[LangGraph Agent]
        Tools[Flight Tools]
        Memory[Memory Store]
        RAGRetriever[RAG Retriever Tool]
        KnowledgeLoader[Knowledge Base Loader]
    end
    
    subgraph KnowledgeBase["Knowledge Base"]
        PickleFile[knowledge_base.pkl]
        JSONFiles[airline_faqs.json]
        YAMLFiles[product_docs.yaml]
    end
    
    subgraph ExternalServices["External Services"]
        OpenAI[OpenAI API]
        AzureSpeech[Azure Speech API]
        AppInsights[Azure App Insights]
    end
    
    Main --> Routers
    Main --> VoiceRouter
    Routers --> UserService
    Routers --> FlightService
    Routers --> BookingService
    Routers --> ChatService
    Routers --> HealthService
    VoiceRouter --> ChatService
    
    UserService --> UserRepo
    FlightService --> FlightRepo
    BookingService --> BookingRepo
    BookingService --> FlightRepo
    ChatService --> ChatRepo
    
    UserRepo --> UserModel
    FlightRepo --> FlightModel
    BookingRepo --> BookingModel
    ChatRepo --> ChatModel
    
    UserModel --> SQLite
    FlightModel --> SQLite
    BookingModel --> SQLite
    ChatModel --> SQLite
    
    Routers --> Auth
    Routers --> Dependencies
    Dependencies --> Resources
    Resources --> Logging
    VoiceRouter --> AudioProcessor
    
    ChatService --> ChatManager
    ChatManager --> LangGraph
    LangGraph --> Tools
    LangGraph --> Memory
    LangGraph --> RAGRetriever
    Tools --> FlightService
    Tools --> BookingService
    RAGRetriever --> KnowledgeLoader
    KnowledgeLoader --> PickleFile
    KnowledgeLoader --> JSONFiles
    KnowledgeLoader --> YAMLFiles
    
    ChatManager --> OpenAI
    AudioProcessor --> AzureSpeech
    Logging --> AppInsights
    
    classDef app fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef business fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef repo fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    classDef data fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef cross fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef ai fill:#f1f8e9,stroke:#388e3c,stroke-width:2px
    classDef kb fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    classDef external fill:#fff8e1,stroke:#f57c00,stroke-width:2px
    
    class FastAPIApp app
    class BusinessLayer business
    class RepositoryLayer repo
    class DataLayer data
    class CrossCutting cross
    class AIIntegration ai
    class KnowledgeBase kb
    class ExternalServices external